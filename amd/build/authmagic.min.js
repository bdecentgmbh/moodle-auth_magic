/**
 * Magic authentication define js.
 * @module   auth_magic
 * @copyright  2023 bdecent gmbh <https://bdecent.de>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("auth_magic/authmagic",["core/str"],(function(String){var AuthMagic=function(params){return params.loginhook&&this.magicLoginHook(params),!0};return AuthMagic.prototype.magicLoginHook=function(params){var authSelector='#page-login-index .potentialidplist a[title="'+params.strbutton+'"]';if(authSelector){var getMagicLink=document.querySelectorAll(authSelector)[0],potentialiDp=document.querySelector("#page-login-index .potentialidplist");potentialiDp&&(potentialiDp=potentialiDp.previousElementSibling);var potentialiDpList=document.querySelectorAll("#page-login-index .potentialidplist .potentialidp");if(void 0===getMagicLink){authSelector="#page-login-index .login-identityproviders a";var getMagicLinks=document.querySelectorAll(authSelector);getMagicLinks.length&&getMagicLinks.forEach((function(item){item.innerHTML.trim()==params.strbutton&&(getMagicLink=item,potentialiDpList=document.querySelectorAll("#page-login-index .login-identityproviders a"),potentialiDp=document.querySelectorAll("#page-login-index .login-identityproviders h2")[0])}))}if(getMagicLink){var getMagicLinkBlock;if(document.querySelector("#page-login-index .potentialidplist")||(getMagicLink.classList.remove("btn-secondary"),getMagicLink.classList.add("btn-primary")),params.linkbtnpos||(params.linkbtnpos=0),0==params.linkbtnpos)if(getMagicLinkBlock=document.querySelectorAll("#page-login-index form#login .form-group")[params.linkbtnpos]){getMagicLinkBlock.appendChild(getMagicLink);var span=document.createElement("span");span.setAttribute("class","magic-password-instruction");var passInfo=String.get_string("passinfo","auth_magic");$.when(passInfo).done((function(localizedEditString){span.innerHTML=localizedEditString})),getMagicLinkBlock.appendChild(span)}if(1==params.linkbtnpos)(getMagicLinkBlock=document.querySelectorAll("#page-login-index form#login .form-group")[params.linkbtnpos])&&getMagicLinkBlock.appendChild(getMagicLink);if(params.linkbtnpos<=1&&potentialiDpList.length<=1){potentialiDp.style.display="none";var identityProvider=document.querySelectorAll("#page-login-index .login-identityproviders")[0];identityProvider&&(identityProvider.previousElementSibling.style.display="none",identityProvider.nextElementSibling.style.display="none")}2==params.linkbtnpos&&getMagicLink.classList.remove("btn-primary"),getMagicLink.addEventListener("click",(function(e){e.preventDefault();var returnurl=e.currentTarget.getAttribute("href"),userValue="",mailSelector=document.querySelectorAll("form#login #username")[0];mailSelector&&(userValue=mailSelector.value);var form=document.createElement("form");form.setAttribute("method","post"),form.setAttribute("action",returnurl),form.setAttribute("id","magic-login-form");var magicLogin=document.createElement("input");magicLogin.setAttribute("type","hidden"),magicLogin.setAttribute("name","magiclogin"),magicLogin.setAttribute("value",1);var uservalue=document.createElement("input");uservalue.setAttribute("type","hidden"),uservalue.setAttribute("name","uservalue"),uservalue.setAttribute("value",userValue),form.appendChild(magicLogin),form.appendChild(uservalue),getMagicLink.parentNode.appendChild(form),document.querySelectorAll("form#magic-login-form")[0].submit()}))}}},{init:function(params){return new AuthMagic(params)}}}));

//# sourceMappingURL=authmagic.min.js.map
/**
 * Magic authentication define js.
 * @module   auth_magic
 * @copyright  2023 bdecent gmbh <https://bdecent.de>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("auth_magic/authmagic",["core/str","core/ajax"],(function(String,Ajax){var AuthMagic=function(params){return params.loginhook&&this.magicLoginHook(params),params.customloginhook&&this.magicCustomLoginHook(params),!0};return AuthMagic.prototype.magicCustomLoginHook=function(params){var MagicLink=this.getMagicLink(params,"#page-local-magic-login");MagicLink&&this.magicLoginHandler(MagicLink,"form#login #id_email",params)},AuthMagic.prototype.getMagicLink=function(params,linkId){var authSelector=linkId+' .potentialidplist a[title="'+params.strbutton+'"]',MagicLink="";if(authSelector&&void 0===(MagicLink=document.querySelectorAll(authSelector)[0])){authSelector=linkId+" .login-identityproviders a";var MagicLinks=document.querySelectorAll(authSelector);MagicLinks.length&&MagicLinks.forEach((function(item){item.innerHTML.trim()==params.strbutton&&(MagicLink=item)}))}return MagicLink},AuthMagic.prototype.magicLoginHook=function(params){var linkId="#page-login-index",MagicLink=this.getMagicLink(params,linkId);if(MagicLink){if(document.querySelector("#page-login-index .potentialidplist")){var potentialiDp=document.querySelector(linkId+" .potentialidplist");potentialiDp&&(potentialiDp=potentialiDp.previousElementSibling);var potentialiDpList=document.querySelectorAll(linkId+" .potentialidplist .potentialidp")}else MagicLink.classList.remove("btn-secondary"),MagicLink.classList.add("btn-primary"),potentialiDpList=document.querySelectorAll(linkId+" .login-identityproviders a"),potentialiDp=document.querySelectorAll(linkId+" .login-identityproviders h2")[0];var MagicLinkBlock;if(params.linkbtnpos||(params.linkbtnpos=0),0==params.linkbtnpos)if(MagicLinkBlock=document.querySelectorAll("#page-login-index form#login .form-group")[params.linkbtnpos]){MagicLinkBlock.appendChild(MagicLink);var span=document.createElement("span");span.setAttribute("class","magic-password-instruction"),String.get_string("passinfo","auth_magic").done((function(localizedEditString){span.innerHTML=localizedEditString})),MagicLinkBlock.appendChild(span)}if(1==params.linkbtnpos)(MagicLinkBlock=document.querySelectorAll("#page-login-index form#login .form-group")[params.linkbtnpos])&&MagicLinkBlock.appendChild(MagicLink);if(params.linkbtnpos<=1&&potentialiDpList.length<=1){potentialiDp.style.display="none";var identityProvider=document.querySelectorAll("#page-login-index .login-identityproviders")[0];identityProvider&&(identityProvider.previousElementSibling.style.display="none",identityProvider.nextElementSibling.style.display="none")}2==params.linkbtnpos&&MagicLink.classList.remove("btn-primary"),this.magicLoginHandler(MagicLink,"form#login #username",params)}},AuthMagic.prototype.getMagicLinkPassCheck=function(){var emailElement=document.querySelector("form.login-form input[name=email]"),passwordElement=document.querySelector("form.login-form input[name=password]"),status=!1;if(emailElement&&passwordElement){var args={email:emailElement.value,password:passwordElement.value};Ajax.call([{methodname:"auth_magic_get_magiclink_passcheck",args:args,done:function(response){status=response.status}}],status)}return status},AuthMagic.prototype.magicLoginHandler=function(MagicLink,mailHandler,params){var self=this;MagicLink.addEventListener("click",(function(e){(e.preventDefault(),params.passcheck)&&document.querySelector("form.login-form .magic-submit-action input").click();if(params.passcheck&&!self.getMagicLinkPassCheck())return"";var returnurl=e.currentTarget.getAttribute("href"),userValue="",mailSelector=document.querySelectorAll(mailHandler)[0];mailSelector&&(userValue=mailSelector.value);var form=document.createElement("form");form.setAttribute("method","post"),form.setAttribute("action",returnurl),form.setAttribute("id","magic-login-form");var magicLogin=document.createElement("input");magicLogin.setAttribute("type","hidden"),magicLogin.setAttribute("name","magiclogin"),magicLogin.setAttribute("value",1);var uservalue=document.createElement("input");uservalue.setAttribute("type","hidden"),uservalue.setAttribute("name","uservalue"),uservalue.setAttribute("value",userValue),form.appendChild(magicLogin),form.appendChild(uservalue),MagicLink.parentNode.appendChild(form),document.querySelectorAll("form#magic-login-form")[0].submit()}))},{init:function(params){return new AuthMagic(params)}}}));

//# sourceMappingURL=authmagic.min.js.map